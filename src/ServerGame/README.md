# 게임 서버의 프로젝트 개요이자 목표
- IOCP를 활용하여 대규모 인원이 참가할 수 있도록 게임 서버를 구축하여 보자
- 게임 입장, 움직임, 골인 등의 컨텐츠 내용을 경험해보기
- 코드를 끊임없이 되돌아보며 고칠 수 있는 코드를 찾고, 수정해보기

## 전체적인 로직
![image](https://user-images.githubusercontent.com/48054868/221213860-47de228c-fff0-4c94-8497-1a71a6fd941b.png)

## Protobuf 형태
- [ProtocolServer.proto](../../config/Protobuf/bin/InGame/ProtocolServer.proto)

## 구현하며 사용한 기술들
- C++
- IOCP Model
- Protocol buffer
- C#
  - 게임 클라이언트의 통신 부분
  
## 구현 기능
### 방 생성 부분
- 입장
- 퇴장
- 재접속 ( 코드로만 구현, 인게임 구현 X )
- 게임 종료시 메모리 정리
- 외부 ID 접속 인원 입장 거부
- 게임 시작 체크
  - NPC 서버에 장애물 정보 전송 확인
  - 게임 입장한 유저의 수가 꽉 차있거나 적정인원이 찼을 때
  - 만약 안될 경우 다시 매치 서버로 돌려보냄
 
### 게임 플레이 부분
- 이동 동기화
- 장애물 동기화
- 게임 승리
- 스테이지 전환
- 플레이어 낙하시 재스폰
- 승리 인원보다 남은 인원이 적을 시 게임 종료

## 아쉬웠던 부분
### 이동 동기화의 완벽한 구현 X
- 클라이언트에 대한 지식 부족으로 인해 혼자 연구가 불가능
- 시도 방법
	1. 틱마다 위치를 전송한다. -> 너무 많이 보내 튀는 현상이 발생
	2. Enum 형식으로 나누어 IDLE 상태가 아닐 때만 패킷 전송 -> 고질적인 대량 패킷 문제는 해결 불가능

```
enum PlayerState
{
	IDLE = 0;
	MOVE = 1;
	JUMP = 2;
	JUMP_LOOP = 3;
	Slide = 4;
}
```

### 패킷 설계
- 기능을 구현하면서 서버 - 클라 구조를 처음 겪다보니 무수한 수정을 거침.
- 패킷의 수정은 Handler 코드의 수정으로 이루어져 시간 소모가 많이 함.
- 이러한 부분을 자동화 하지 못한게 아쉽습니다.

```
// position, rotation 중복
message Player
{
	int64 id = 1;
	optional Vector position = 2;
	optional Vector rotation = 3;
}

message PlayerCrash
{
	int64 id = 1;
	Vector position = 2;
	Vector rotation = 3;
	Player enemy = 4;
}
```

### 네트워크 오류
- 구현 마지막 단계에서 특정 인원이 접속하지 못하는 현상 발생
- 여러 로직을 고쳐 보았지만 짧은 시간안에 해결 하지 못함..

## 느낀 점
- 로컬에서나 타 프로젝트를 했을 때, 네트워크 오류로 인한 문제가 없었기 때문에 콘텐츠 부분에 집중하는 좁은 시야가 있었는데 이번 프로젝트에서 새로운 오류를 겪어 보면서 좁아졌던 시야를 다시 넓혀볼 수 있는 계기가 되었습니다.
 이러한 계기를 바탕으로 프로젝트를 다시 훑어보며 내가 왜 그런 생각을 가지게 되었고, 앞으로는 어떻게 해 나갈 것이지를 다시 한번 되돌아보는 시간을 가져볼 것입니다.
- 게임 서버의 길은 험하고, 생각보다 신경써야할 것들이 너무 많다는 것을 느꼈습니다. 그리고 강의에서는 왜 쓰이는 것인지 몰랐던 부분들이 존재하였는데 이번 프로젝트를 하면서 그러한 부분들을 이해해나갈 수 있었습니다.

## 앞으로의 길
- 게임 서버 강의를 다시 한번 정주행하여 저만의 IOCP 서버를 구성할 것입니다. 이후 만든 서버 코어를 통해 이번에 했던 프로젝트의 코어와 교체하여 잘 작동되는지, 네트워크 오류는 해결되는지, 된다면 성능은 어느정도 나오는지 한번 확인해보려고 합니다.
- 추가적으로 게임 클라 부분, 특히 이동 동기화를 같이 고민하게 되면서 게임 클라이언트적인 부분을 배우고 싶다는 생각이 들었고, 클라이언트 부분을 공부하여 연구해나가고 싶습니다.
- 이번 프로젝트 이후에도 여승환 이사님께서 말씀해주신 내용들을 토대로, 계속해서 회고하고 저 자신에게 질문해나가며 목표를 확실하게 할 수 있는 개발자가 되어 볼 것입니다.
